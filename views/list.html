<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">    
    <link rel="stylesheet" href="list.css"> <!-- css.css라는 외부 CSS 파일에 연결 -->
</head>
<body>
    <%- include('menu.html') %>


    <div id="container" class="article">
      <div class="wrap_title">
          <strong>게시판</strong> <!-- 게시판 -->
      </div>
      
    <div class="container-button">
      <div class="row justify-content-left">
          <div class="col-auto">
              <button class="filter-button" data-category="">전체</button>
          </div>
          <div class="col-auto">
              <button class="filter-button" data-category="category1">운동공유</button>
          </div>
          <div class="col-auto">
              <button class="filter-button" data-category="category2">식단공유</button>
          </div>
          <div class="col-auto">
              <button class="filter-button" data-category="category3">Q&A</button>
          </div>
          <div class="col-auto">
              <button class="filter-button" data-category="category4">일상</button>
          </div>
      </div>
  </div>

  <table class="table container">
      <tbody>
        <% for(let i = 0; i < data.length; i++){ %> 
          <tr>
            
            <td>
                <span class="category"><%= data[i].category %></span>
                <span class="date"><%= data[i].date %></span>
                <a href="content/<%= data[i]._id %>" class="link"><%= data[i].title %></a>
                <button class="delete btn btn-outline-danger" data-id="<%= data[i]._id %>">삭제</button>
            </td>
        </tr>
        <% } %>
        <!--ejs 사용 문법
          제어문 -> <% %>
          변수 출력 -> <%= %>
         -->
        </tbody>            
      </table>
      
      <!-- 우측 하단에 추가 버튼 -->
      <div class = "container my-3">  <!-- 부트스트랩에서 제공하는 스타일임. 버튼의 화면 배치 간격 설정-->
        <button class = "btn btn-primary enter" style="float: right;"></button>
      </div>
      
      <!--게시물 삭제-->
      <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
        <script>
          $('.delete').click(function(e){
            //클래스가 delete인 엘리먼트를 클릭하면 실행
            let sid = e.target.dataset.id;
            let item =$(this);  //클릭한 삭제 버튼 엘리먼트를 $(this)로 얻어와서 변수 item에 저장

            $.ajax({
            type : 'post',
            url : '/delete',
            data : {_id : sid}
          }).done(function(result){
            //응답에 성공했을 때
            //location.reload(); //페이지를 강제 새로고침 해줌, 근데 이건 '전체 페이지'를 새로고침 해주는 거라 안 씀
            item.parent('td').parent('tr').remove();
          }).fail(function(xhr, textStatus, errorThrown){
            //응답에 실패했을 때
            console.log('게시물 삭제 실패');
            console.log(xhr, textStatus, errorThrown);
            /*
            xhr = 오류코드 포함 (ex. 404 or 500)
            textStus = 'ERROR'라는 고정값을 갖는 문자열이 전달
            errorThrown = 오류의 원인을 의미하는 문자열 전달
            (ex, 404 오류일 경우 = 'Page Not Found')
            */

          });
        });

        // 륜아 : 이 부분을 카테고리 때문에 추가해봤습니다.

                // 카테고리 필터링
                $('.filter-button').click(function() {
            let category = $(this).attr('data-category');

            $.ajax({
                type: 'get',
                url: '/list/' + category
            }).done(function(result) {
                $('tbody').html(result);
            }).fail(function(xhr, textStatus, errorThrown) {
                console.log('게시물 필터링 실패');
                console.log(xhr, textStatus, errorThrown);
            });
        });

        
        // 이게 추가버튼 누르면 페이지 넘어가는 코드
        $('.enter').click(function(e){  //이벤트 핸들러 정의
          location.href = "/enter";  
        })
        </script>

    
</body>
</html>